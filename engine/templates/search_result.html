{% extends "home.html" %}
{% load crispy_forms_tags %}
{% load staticfiles %}
{% load extended_tags %}
{% block set_list %}

{% include 'search_result_style.html' %}

    {% if error != '' %}

        <h1>Error</h1>

    {% else %}

            <div class="container-fluid" style="min-height:95%;">
                <div class="row" style="margin-top:1%;">
                    <div class="col-sm-1"></div>
                    <div id="row" class="col-sm-6" style="">

                        <div style="" class="">
                          <h4 class="">Related Products</h4>

                            <div class="">
                            {% for card in related_products %}
                                <div class="">
                                    <form style="float:left;" method="GET" action="{% url 'search' %}">
                                        <button style="border:none;outline:none;background-color:Transparent;" type="submit">
                                            <img style="max-height:120px;" src="{{card.image}}">
                                        </button>
                                        <input type="hidden" name="q" value="{{card.name}}">
                                    </form>
                                </div>
                            {% endfor %}
                            </div>

                        </div>

                        <div style="" class="">
                            <table style="color: rgb(80,80,80); margin-top: 5%;" class="nav-pills nav-stacked table table table-hover table-sm">
                                <thead class="thead-inverse">
                                    <tr class="header">
                                      <th id=""></th>
                                      <th id="n">Name</th>
                                      <th id="">Expansion</th>
                                        <th>Condition</th>
                                      <th id="p">Price</th>
                                    </tr>
                                </thead>
                                <tbody>

                                {% for item in items %}


									<tr class="">
                                        <td>
                                            <img onclick="Large(this)" style="max-height:75px;" src="{{item.image_url}}">
                                            <div id="imgbox"></div>

                                        </td>

										<td>
											<a href="{% url 'product_detail' 126451 %}">{{item.product_name}}</a>
										</td>
										<td>({{item.set_name}})</td>

                                        <td>Near Mint Foil</td>

                                        <td>
                                            <form action="{% url 'add_to_cart' item.id %}" method="post">
                                                {% csrf_token %}
                                                <div class="form-box">

                                                        <span class="mr-1">${{1.99|floatformat:2}}</span>

                                                        <input class="mr-1" style="" size="2" type="number" name="quantity" min="1" max="8">

                                                        <button class="btn btn-success mr-1" style=""><i class="material-icons">add</i></button>
                                                </div>




                                            </form>
                                        </td>
									</tr>

								</tbody>
                                {% endfor %}

                            </table>
                        </div>

                    </div>

                    {% include 'sidebar.html' %}
                </div>
            </div>



    {% endif %}

    {% block script %}
    <script>

        function getElementLeft(elm)
{
    var x = 0;

    //set x to elm’s offsetLeft
    x = elm.offsetLeft;

    //set elm to its offsetParent
    elm = elm.offsetParent;

    //use while loop to check if elm is null
    // if not then add current elm’s offsetLeft to x
    //offsetTop to y and set elm to its offsetParent

    while(elm != null)
    {
        x = parseInt(x) + parseInt(elm.offsetLeft);
        elm = elm.offsetParent;
    }
    return x;
}

function getElementTop(elm)
{
    var y = 0;

    //set x to elm’s offsetLeft
    y = elm.offsetTop;

    //set elm to its offsetParent
    elm = elm.offsetParent;

    //use while loop to check if elm is null
    // if not then add current elm’s offsetLeft to x
    //offsetTop to y and set elm to its offsetParent

    while(elm != null)
    {
        y = parseInt(y) + parseInt(elm.offsetTop);
        elm = elm.offsetParent;
    }

    return y;
}


function Large(obj)
{
    var imgbox=document.getElementById("imgbox");
    imgbox.style.visibility='visible';
    var img = document.createElement("img");
    img.src=obj.src;
    img.style.width='560px';
    img.style.height='780px';

    if(img.addEventListener){
        img.addEventListener('mouseout',Out,false);
    } else {
        img.attachEvent('onmouseout',Out);
    }
    imgbox.innerHTML='';
    imgbox.appendChild(img);
    imgbox.style.left=(getElementLeft(obj)-50) +'px';
    imgbox.style.top=(getElementTop(obj)-50) + 'px';
}

function Out()
{
    document.getElementById("imgbox").style.visibility='hidden';
}


       $(document).on('change','#id_condition_select',function(){
          var product_id = this.dataset.product_id;

           $.ajax({
            url: '/ajax/info/',
            data: {
              'product_id': product_id
            },

            dataType: 'json',
            success: function (data) {
              alert("D" + data.card);

            }
          });

       });
       $(document).on('change','#id_language_select',function(){console.log(this.value)});
       $(document).on('change','#id_foil_select',function(){console.log(this.value)});

  </script>
{% endblock %}


 <!-- <script>
  var init_condition = 'near mint';
  var init_language = 'english';
  var init_foil = false;
  var dict = {{model|safe}};
  

  function conditionChange(obj){
    var condition = obj.value;
    init_condition = condition;
    var idee = obj.id;
    var item_condition = dict[idee][init_foil][init_language][condition]['condition'];
    var item_quantity = dict[idee][init_foil][init_language][condition]['quantity'];
    var item_price = dict[idee][init_foil][init_language][condition]['price'];

    document.getElementById('price_' + obj.id).innerText = '$' + item_price + " " + "(" + (item_quantity) + " in stock)";
  }


  function languageChange(obj){
    var language = obj.value;
    init_language = language;
    var idee = obj.id;
    var item_condition = dict[idee][init_foil][language][init_condition]['condition'];
    var item_price = dict[idee][init_foil][language][init_condition]['price'];
    var item_quantity = dict[idee][init_foil][language][init_condition]['quantity'];

    document.getElementById('price_' + obj.id).innerText = '$' + item_price + " " + "(" + (item_quantity) + " in stock)";

  }


  function foilChange(obj){
    var foil = obj.value;
    init_foil = foil;
    var idee = obj.id;
    var item_condition = dict[idee][foil][init_language][init_condition]['condition'];
    var item_price = dict[idee][foil][init_language][init_condition]['price'];
    var item_quantity = dict[idee][foil][init_language][init_condition]['quantity'];
    document.getElementById('price_' + obj.id).innerText = '$' + item_price + " " + "(" + (item_quantity) + " in stock)";

  }




</script>   -->   


{% endblock %}



  



