{% extends "home.html" %}
{% load crispy_forms_tags %}
{% load static %}
{% load extended_tags %}

{% block set_list %}

<link rel="stylesheet" type="text/css" href="{% static 'custom_css/search_result.css' %}">

<script src="{% static 'custom_js/search_condition_tab.js' %}"></script>
<script>
  $( function() {
    $( "#accordion" ).accordion({
      collapsible: true,
      active: false,
      heightStyle: "content",
    });
  } );
  </script>

{% if error != '' %}

    <h1>Error</h1>
{% else %}

    <div class="container-fluid" style="min-height:95%;">
        <div class="row">
            <nav class="col-md-2 d-none d-sm-block bg-dark sidebar" style="">
                <div class="sidebar-sticky">
                    <div style="">
                        <hr style="background-color: white;">
                        <h4 style="color: rgba(255, 255, 255, 0.6);" class="active"> Advanced Search <i class="material-icons"></i></h4>
                        <div>
                            <form method="GET" action="{% url 'search' %}">
                                 <fieldset>
                                     <div id="accordion">


                                         <label>Name</label>
                                         <div>
                                             <div class="form-row">
                                                  <div class="input-group input-group-sm mb-3">
                                                      {{form.name_query|as_crispy_field}}
                                                  </div>
                                             </div>
                                             <div class="form-row">
                                                  <div class="input-group input-group-sm mb-3">
                                                      {{form.name}}
                                                  </div>
                                             </div>

                                         </div>

                                         <label>Oracle Text</label>
                                         <div class="form-row">
                                            <div class="input-group input-group-sm mb-3">
                                              {{form.oracle_text}}
                                            </div>
                                         </div>

                                         <label>Set</label>
                                         <div class="form-row">
                                            <div class="input-group input-group-sm mb-3">
                                              {{form.expansion}}
                                            </div>
                                         </div>

                                         <label>Colors</label>
                                         <div>

                                             <div style="" class="form-row">
                                                 <div class="form-check form-check-inline">
                                                     {{form.colors|as_crispy_field}}
                                                 </div>
                                             </div>
                                         </div>

                                         <label>Color Identity</label>
                                         <div style="" class="form-row">
                                            <div class="input-group input-group-sm mb-3">
                                              {{form.color_identity|as_crispy_field}}
                                            </div>
                                         </div>

                                         <label>CMC
                                             <i class="material-icons help-bubble" title="converted mana cost">help</i></label>
                                         <div class="form-row">
                                            <div style="max-width: 70%;" class="input-group input-group-sm">
                                                {{form.cmc_start}}&nbsp;<span class="advanced-search-between-inputs">to
                                            </span>&nbsp;{{form.cmc_end}}
                                            </div>
                                         </div>

                                         <label>Rarity</label>
                                         <div style="" class="form-row">
                                            <div class="input-group input-group-sm mb-3">
                                              {{form.rarity|as_crispy_field}}
                                            </div>
                                         </div>

                                         <label>Type</label>
                                         <div style="" class="form-row">
                                            <div class="input-group input-group-sm mb-3">
                                              {{form.card_type|as_crispy_field}}
                                            </div>
                                         </div>

                                         <label>Subtypes</label>
                                         <div style="" class="form-row">
                                            <div class="input-group input-group-sm mb-3">
                                              {{form.subtypes|as_crispy_field}}
                                            </div>
                                         </div>

                                         <label>Power</label>
                                         <div class="form-row">
                                            <div style="max-width: 70%;" class="input-group input-group-sm">
                                                {{form.power_start}}&nbsp;<span class="advanced-search-between-inputs">to
                                            </span>&nbsp;{{form.power_end}}
                                            </div>
                                         </div>

                                         <label>Toughness</label>
                                         <div class="form-row">
                                            <div style="max-width: 70%;" class="input-group input-group-sm">
                                                {{form.toughness_start}}
                                                &nbsp;<span class="advanced-search-between-inputs">to</span>&nbsp;
                                                {{form.toughness_end}} <br>
                                            </div>
                                         </div>



                                     </div>
                                 </fieldset>
                                <button name="advanced-search-form" value="advanced-query" style="margin-top:1%;" class="btn btn-secondary btn-lg btn-block"
                                        type="submit">Apply
                                    Filters</button>
                            </form>
                        </div>
                    </div>
                </div>
            </nav>
            <div style="" class="col-sm-10">
                <table style="color: rgb(80,80,80);" class="nav-tabs nav-stacked table table table-hover table-lg">
                    <thead class="thead-inverse">
                    </thead>
                    <tbody>
                        {% for item in items %}
                            <tr>
                                <td>
                                    <img style="max-height:200px;" src="{{item.image_url}}">
                                    <div id="imgbox"></div>
                                </td>

                                <td>
                                    <a href="{% url 'product_detail' item.product_id %}">{{item.name}}</a>
                                </td>

                                <td>{{item.mana_cost}}</td>

                                <td>{{item.card_type}}</td>

                                <td>{{item.expansion}} ({{item.rarity}})</td>

                                <td>
                                    <div style="position: relative;">

                                        <ul class="nav nav-tabs mb-3 condition-info" id="{{item.product_id}}" role="tablist"></ul>

                                        <script>
                                             conditionTab(
                                                "clean", "CL", "{{item.normal_clean_stock}}", "{{item.foil_clean_stock}}", "{{item.product_id}}",
                                                "true"
                                             );

                                              conditionTab(
                                                "played", "PL", "{{item.normal_played_stock}}", "{{item.foil_played_stock}}", "{{item.product_id}}",
                                                "false"
                                             );

                                             conditionTab(
                                                "heavily_played", "HP", "{{item.normal_heavily_played_stock}}",
                                                 "{{item.foil_heavily__played_stock}}", "{{item.product_id}}", "false"
                                             );
                                        </script>


                                        <div class="tab-content" id="tabs-tabContent-{{item.product_id}}">



                                        </div>

                                        <script>
                                            populateConditionTable(
                                                "true", "clean", "{{item.product_id}}", "{{item.normal_clean_stock}}",
                                                 "{{item.foil_clean_stock}}", "{{item.normal_clean_price}}", "{{item.foil_clean_price}}"
                                            );

                                            populateConditionTable(
                                                "false", "played", "{{item.product_id}}", "{{item.normal_played_stock}}",
                                                 "{{item.foil_played_stock}}", "{{item.normal_played_price}}", "{{item.foil_played_price}}"
                                            );

                                            populateConditionTable(
                                                "false", "heavily_played", "{{item.product_id}}", "{{item.normal_heavily_played_stock}}",
                                                 "{{item.foil_heavily_played_stock}}", "{{item.normal_heavily_played_price}}",
                                                 "{{item.foil_heavily_played_price}}"
                                            );

                                        </script>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>

                </table>
            </div>

        </div>

    </div>



{% endif %}

<script src="{% static 'custom_js/select_tab_search_results.js' %}"></script>

<!-- Load autocomplete() function from jquery -->
<script src="{% static 'custom_js/jquery_autocomplete.js' %}"></script>

<!-- Load jqueryMultiFieldAutocomplete() function from jquery -->
<script src="{% static 'custom_js/jquery_multi_autocomplete.js' %}"></script>

<script>
    $.ajax({
        method: "GET",
        url: "{% url 'card_info' %}",
        success: function(data){
            autocomplete(data.expansions, "#advanced-search-form-expansion");
            jqueryMultiFieldAutocomplete(data.subtypes, "#advanced-search-form-subtypes");
            console.log(data.subtypes);
        },
    });
</script>


{% endblock %}
<!--  -->